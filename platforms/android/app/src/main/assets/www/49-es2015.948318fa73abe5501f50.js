(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{xKnB:function(t,n,i){"use strict";i.r(n),i.d(n,"StripePaymentsPageModule",function(){return O});var e=i("ofXK"),o=i("3Pt+"),r=i("TEn/"),s=i("tyNb"),c=i("mrSG"),a=i("2Rin"),d=i("PSD3"),l=i.n(d),u=i("c14U"),h=i("wd/R"),b=i("8RPc"),p=i("fXoL");function g(t,n){if(1&t&&(p.Vb(0,"div"),p.Vb(1,"p",12),p.Ac(2),p.Ub(),p.Ub()),2&t){const t=p.hc();p.Fb(2),p.Bc(t.util.translate("No Card Found Please Add Card"))}}function m(t,n){1&t&&(p.Vb(0,"ion-item"),p.Vb(1,"ion-label"),p.Vb(2,"h3"),p.Rb(3,"ion-skeleton-text",13),p.Ub(),p.Vb(4,"p"),p.Rb(5,"ion-skeleton-text",14),p.Ub(),p.Vb(6,"p"),p.Rb(7,"ion-skeleton-text",15),p.Ub(),p.Ub(),p.Ub())}function f(t,n){if(1&t){const t=p.Wb();p.Vb(0,"ion-item",16),p.Vb(1,"ion-thumbnail",17),p.Vb(2,"ion-label"),p.Ac(3),p.Ub(),p.Ub(),p.Vb(4,"ion-radio",18),p.dc("ionSelect",function(){p.uc(t);const i=n.$implicit;return p.hc().changeMethod(i.id)}),p.Ub(),p.Vb(5,"ion-label"),p.Ac(6),p.Rb(7,"br"),p.Ac(8),p.Ub(),p.Ub()}if(2&t){const t=n.$implicit,i=p.hc();p.Fb(3),p.Cc("",t.brand," "),p.Fb(1),p.nc("value",t.id),p.Fb(2),p.Cc("XXXX",t.last4," "),p.Fb(2),p.Ec(" ",i.util.translate("Expiry")," ",t.exp_month," / ",t.exp_year," ")}}function _(t,n){if(1&t&&(p.Vb(0,"span"),p.Ac(1),p.Ub()),2&t){const t=p.hc(2);p.Fb(1),p.Dc(" ",t.util.currecny," ",t.cart.grandTotal,"")}}function y(t,n){if(1&t&&(p.Vb(0,"span"),p.Ac(1),p.Ub()),2&t){const t=p.hc(2);p.Fb(1),p.Dc(" ",t.cart.grandTotal," ",t.util.currecny,"")}}function v(t,n){if(1&t){const t=p.Wb();p.Vb(0,"ion-button",19),p.dc("click",function(){return p.uc(t),p.hc().payment()}),p.Ac(1),p.zc(2,_,2,2,"span",7),p.zc(3,y,2,2,"span",7),p.Ub()}if(2&t){const t=p.hc();p.Fb(1),p.Cc(" ",t.util.translate("Payment")," "),p.Fb(1),p.nc("ngIf","left"===t.util.cside),p.Fb(1),p.nc("ngIf","right"===t.util.cside)}}const C=[{path:"",component:(()=>{class t{constructor(t,n,i,e,o){this.router=t,this.api=n,this.util=i,this.navCtrl=e,this.cart=o,this.cards=[],this.dummy=[],this.api.post("users/getById",{id:this.cart.cartStoreInfo.uid}).then(t=>{t&&200===t.status&&t.data&&t.data.length&&(this.storeFCM=t.data[0].fcm_token)},t=>{})}ngOnInit(){}getCards(){this.dummy=Array(10),this.api.httpGet("https://api.stripe.com/v1/customers/"+this.util.userInfo.stripe_key+"/sources?object=card",this.util.stripe).subscribe(t=>{this.dummy=[],t&&t.data&&(this.cards=t.data,this.token=this.cards[0].id)},t=>{if(this.dummy=[],t&&t.error&&t.error.error&&t.error.error.message)return this.util.showErrorAlert(t.error.error.message),!1;this.util.errorToast("Algo ha ido mal")})}payment(){l.a.fire({title:this.util.translate("Are you sure?"),text:this.util.translate("Orders once placed cannot be cancelled and are non-refundable"),icon:"question",confirmButtonText:this.util.translate("Yes"),cancelButtonText:this.util.translate("cancel"),showCancelButton:!0,backdrop:!1,background:"white"}).then(t=>{if(t&&t.value){const t={amount:100*parseInt(this.cart.grandTotal),currency:this.util.stripeCode,customer:this.util.userInfo.stripe_key,card:this.token},n="https://api.stripe.com/v1/charges";this.util.show(),this.api.externalPost(n,t,this.util.stripe).subscribe(t=>{this.paykey=t.id,this.util.hide(),this.util.showToast(this.util.translate("Payment Success"),"success","bottom"),this.createOrder()},t=>{if(this.util.hide(),this.util.hide(),t&&t.error&&t.error.error&&t.error.error.message)return this.util.showErrorAlert(t.error.error.message),!1;this.util.errorToast("Algo ha ido mal")})}})}createOrder(){return Object(c.a)(this,void 0,void 0,function*(){const t={address:JSON.stringify(this.cart.deliveryAddress),applied_coupon:this.cart.coupon&&this.cart.coupon.discount?1:0,coupon_id:this.cart.coupon&&this.cart.coupon.discount?this.cart.coupon.id:0,pay_method:"stripe",did:"",delivery_charge:this.cart.deliveryPrice,discount:this.cart.discount,grand_total:this.cart.grandTotal,orders:JSON.stringify(this.cart.cart),paid:this.paykey,restId:this.cart.cartStoreInfo.uid,serviceTax:this.cart.orderTax,status:"created",time:h().format("YYYY-MM-DD HH:mm:ss"),total:this.cart.totalPrice,uid:localStorage.getItem("uid"),notes:this.cart.orderNotes};this.util.show(),this.api.post("orders/save",t).then(t=>{this.util.hide(),this.cart.orderNotes="",this.api.sendNotification("You have received new order","New Order Received",this.storeFCM),this.util.publishNewOrder(),this.cart.clearCart(),this.navCtrl.navigateRoot(["/success"])},t=>{this.util.hide(),this.util.showToast("Algo ha ido mal","danger","bottom")})})}onAdd(){this.router.navigate(["add-card"])}back(){this.navCtrl.back()}changeMethod(t){this.token=t}ionViewWillEnter(){this.util.userInfo&&this.util.userInfo.stripe_key&&this.getCards()}}return t.\u0275fac=function(n){return new(n||t)(p.Qb(s.g),p.Qb(b.a),p.Qb(a.a),p.Qb(r.db),p.Qb(u.a))},t.\u0275cmp=p.Kb({type:t,selectors:[["app-stripe-payments"]],decls:17,vars:6,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],["slot","end"],["slot","end","name","add"],[1,"div_content"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"],["class","div_inner","lines","none",4,"ngFor","ngForOf"],["expand","block","class","btn_addcard",3,"click",4,"ngIf"],[1,"ion-text-center"],["animated","",2,"width","50%"],["animated","",2,"width","80%"],["animated","",2,"width","60%"],["lines","none",1,"div_inner"],["slot","end",2,"display","flex","flex-direction","column","justify-content","center","align-items","center"],["slot","start",3,"value","ionSelect"],["expand","block",1,"btn_addcard",3,"click"]],template:function(t,n){1&t&&(p.Vb(0,"ion-header"),p.Vb(1,"ion-toolbar",0),p.Vb(2,"ion-buttons",1),p.Vb(3,"ion-button",2),p.dc("click",function(){return n.util.back()}),p.Rb(4,"ion-icon",3),p.Ub(),p.Ub(),p.Vb(5,"ion-title"),p.Ac(6),p.Ub(),p.Vb(7,"ion-buttons",4),p.Vb(8,"ion-button",2),p.dc("click",function(){return n.onAdd()}),p.Rb(9,"ion-icon",5),p.Ub(),p.Ub(),p.Ub(),p.Ub(),p.Vb(10,"ion-content"),p.Vb(11,"div",6),p.zc(12,g,3,1,"div",7),p.zc(13,m,8,0,"ion-item",8),p.Vb(14,"ion-radio-group",9),p.dc("ngModelChange",function(t){return n.token=t}),p.zc(15,f,9,6,"ion-item",10),p.Ub(),p.zc(16,v,4,3,"ion-button",11),p.Ub(),p.Ub()),2&t&&(p.Fb(6),p.Bc(n.util.translate("Pay with Stripe")),p.Fb(6),p.nc("ngIf",!(null!=n.cards&&n.cards.length||null!=n.dummy&&n.dummy.length)),p.Fb(1),p.nc("ngForOf",n.dummy),p.Fb(1),p.nc("ngModel",n.token),p.Fb(1),p.nc("ngForOf",n.cards),p.Fb(1),p.nc("ngIf",null==n.cards?null:n.cards.length))},directives:[r.s,r.X,r.h,r.g,r.t,r.W,r.m,e.j,e.i,r.A,r.jb,o.h,o.k,r.v,r.w,r.L,r.V,r.z,r.ib],styles:[".btn_right[_ngcontent-%COMP%]{position:relative;z-index:999999}.img_menu[_ngcontent-%COMP%]{width:17px;position:absolute;right:20px}.div_content[_ngcontent-%COMP%]{width:100%;padding-left:20px;padding-right:20px}.div_content[_ngcontent-%COMP%]   .div_inner[_ngcontent-%COMP%]{width:100%;margin-top:15px;padding-bottom:15px}.div_content[_ngcontent-%COMP%]   .div_inner[_ngcontent-%COMP%]   .r[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%)}.div_content[_ngcontent-%COMP%]   .div_inner[_ngcontent-%COMP%]   .img_visa[_ngcontent-%COMP%], .div_content[_ngcontent-%COMP%]   .div_inner[_ngcontent-%COMP%]   .lbl_number[_ngcontent-%COMP%]{display:block;font-size:17px;color:gray;margin-left:10px}.div_content[_ngcontent-%COMP%]   .div_inner[_ngcontent-%COMP%]   .img_visa[_ngcontent-%COMP%]{float:right;position:absolute;top:50%;transform:translateY(-50%);height:15px!important;width:50px!important}.btn_addcard[_ngcontent-%COMP%]{margin-top:30px;--box-shadow:none!important}"]}),t})()}];let w=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({imports:[[s.i.forChild(C)],s.i]}),t})(),O=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=p.Ob({type:t}),t.\u0275inj=p.Nb({imports:[[e.b,o.e,r.Y,w]]}),t})()}}]);