(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"3ONh":function(t,e,r){"use strict";r.r(e),r.d(e,"AddCardPageModule",function(){return b});var i=r("ofXK"),s=r("3Pt+"),a=r("TEn/"),n=r("tyNb"),o=r("2Rin"),l=r("8RPc"),d=r("wd/R"),c=r("fXoL");const u=[{path:"",component:(()=>{class t{constructor(t,e,r){this.navCtrl=t,this.util=e,this.api=r,this.cnumber="",this.cname="",this.cvc="",this.date="",this.email=""}ngOnInit(){}back(){this.navCtrl.back()}addcard(){if(""===this.email||""===this.cname||""===this.cnumber||""===this.cvc||""===this.date)return this.util.showToast(this.util.translate("All Fields are required"),"danger","bottom"),!1;if(!/^[\w._-]+[+]?[\w._-]+@[\w.-]+\.[a-zA-Z]{2,6}$/.test(this.email))return this.util.showToast(this.util.translate("Please enter valid email"),"danger","bottom"),!1;const t=this.date.split("-")[0],e=this.date.split("-")[1];if(this.util.userInfo&&this.util.userInfo.stripe_key&&""!==this.util.userInfo.stripe_key){const r={"card[number]":this.cnumber,"card[exp_month]":e,"card[exp_year]":t,"card[cvc]":this.cvc};this.util.show(),this.api.externalPost("https://api.stripe.com/v1/tokens",r,this.util.stripe).subscribe(t=>{t&&t.id?this.api.externalPost("https://api.stripe.com/v1/customers/"+this.util.userInfo.stripe_key+"/sources",{source:t.id},this.util.stripe).subscribe(t=>{this.util.hide(),this.back()},t=>{this.util.hide()}):this.util.hide()},t=>{if(this.util.hide(),t&&t.error&&t.error.error&&t.error.error.message)return this.util.errorToast(t.error.error.message),!1;this.util.errorToast("Algo ha ido mal")})}else{const r={"card[number]":this.cnumber,"card[exp_month]":e,"card[exp_year]":t,"card[cvc]":this.cvc};this.util.show(),this.api.externalPost("https://api.stripe.com/v1/tokens",r,this.util.stripe).subscribe(t=>{t&&t.id?this.api.externalPost("https://api.stripe.com/v1/customers",{description:"Customer for food app",source:t.id,email:this.email},this.util.stripe).subscribe(t=>{if(this.util.hide(),t&&t.id){const e={id:localStorage.getItem("uid"),stripe_key:t.id};this.updateUser(e)}},t=>{if(this.util.hide(),t&&t.error&&t.error.error&&t.error.error.message)return this.util.showErrorAlert(t.error.error.message),!1;this.util.errorToast("Algo ha ido mal")}):this.util.hide()},t=>{if(this.util.hide(),t&&t.error&&t.error.error&&t.error.error.message)return this.util.showErrorAlert(t.error.error.message),!1;this.util.errorToast("Algo ha ido mal")})}}updateUser(t){this.util.show(this.util.translate("updating...")),this.api.post("users/edit_profile",t).then(t=>{this.util.hide();const e={id:localStorage.getItem("uid")};this.api.post("users/getById",e).then(t=>{t&&200===t.status&&t.data&&t.data.length?(this.util.userInfo=t.data[0],this.navCtrl.back()):this.navCtrl.back()},t=>{})},t=>{this.util.hide(),this.util.errorToast("Algo ha ido mal")})}getMaxDate(){return d().add("50","years").format("YYYY-MM-DD")}minStartDate(){return d().format("YYYY-MM-DD")}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(a.db),c.Qb(o.a),c.Qb(l.a))},t.\u0275cmp=c.Kb({type:t,selectors:[["app-add-card"]],decls:20,vars:13,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"ion-padding"],[1,"inputType"],["type","email",3,"placeholder","ngModel","ngModelChange"],["type","number",3,"placeholder","ngModel","ngModelChange"],["type","text",3,"placeholder","ngModel","ngModelChange"],["type","password",3,"placeholder","ngModel","ngModelChange"],["display-format","MM/YYYY","placeholder","MM/YYYY",3,"min","max","ngModel","ngModelChange"],["expand","full","color","primary",1,"btn_addcard",3,"click"]],template:function(t,e){1&t&&(c.Vb(0,"ion-header"),c.Vb(1,"ion-toolbar",0),c.Vb(2,"ion-buttons",1),c.Vb(3,"ion-button",2),c.dc("click",function(){return e.back()}),c.Rb(4,"ion-icon",3),c.Ub(),c.Ub(),c.Vb(5,"ion-title"),c.Ac(6),c.Ub(),c.Ub(),c.Ub(),c.Vb(7,"ion-content",4),c.Vb(8,"div",5),c.Vb(9,"ion-input",6),c.dc("ngModelChange",function(t){return e.email=t}),c.Ub(),c.Ub(),c.Vb(10,"div",5),c.Vb(11,"ion-input",7),c.dc("ngModelChange",function(t){return e.cnumber=t}),c.Ub(),c.Ub(),c.Vb(12,"div",5),c.Vb(13,"ion-input",8),c.dc("ngModelChange",function(t){return e.cname=t}),c.Ub(),c.Ub(),c.Vb(14,"div",5),c.Vb(15,"ion-input",9),c.dc("ngModelChange",function(t){return e.cvc=t}),c.Ub(),c.Ub(),c.Vb(16,"div",5),c.Vb(17,"ion-datetime",10),c.dc("ngModelChange",function(t){return e.date=t}),c.Ub(),c.Ub(),c.Vb(18,"ion-button",11),c.dc("click",function(){return e.addcard()}),c.Ac(19),c.Ub(),c.Ub()),2&t&&(c.Fb(6),c.Cc(" ",e.util.translate("Add New Card")," "),c.Fb(3),c.nc("placeholder",e.util.translate("Email address"))("ngModel",e.email),c.Fb(2),c.nc("placeholder",e.util.translate("Card Number"))("ngModel",e.cnumber),c.Fb(2),c.nc("placeholder",e.util.translate("Card Holder Name"))("ngModel",e.cname),c.Fb(2),c.nc("placeholder",e.util.translate("CVC"))("ngModel",e.cvc),c.Fb(2),c.nc("min",e.minStartDate())("max",e.getMaxDate())("ngModel",e.date),c.Fb(2),c.Cc("",e.util.translate("Add Card")," "))},directives:[a.s,a.X,a.h,a.g,a.t,a.W,a.m,a.u,a.kb,s.h,s.k,a.fb,a.n,a.jb],styles:[".inputType[_ngcontent-%COMP%]{margin-bottom:10px;padding:0 5px;box-shadow:0 0 20px -3px rgba(30,98,255,.3)}ion-datetime[_ngcontent-%COMP%]{--padding-start:0px}"]}),t})()}];let h=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({imports:[[n.i.forChild(u)],n.i]}),t})(),b=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({imports:[[i.b,s.e,a.Y,h]]}),t})()}}]);