!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"3ONh":function(r,i,n){"use strict";n.r(i),n.d(i,"AddCardPageModule",function(){return v});var a,o,s,l=n("ofXK"),c=n("3Pt+"),u=n("TEn/"),d=n("tyNb"),h=n("2Rin"),b=n("8RPc"),p=n("wd/R"),m=n("fXoL"),f=[{path:"",component:(a=function(){function r(e,i,n){t(this,r),this.navCtrl=e,this.util=i,this.api=n,this.cnumber="",this.cname="",this.cvc="",this.date="",this.email=""}var i,n,a;return i=r,(n=[{key:"ngOnInit",value:function(){}},{key:"back",value:function(){this.navCtrl.back()}},{key:"addcard",value:function(){var t=this;if(""===this.email||""===this.cname||""===this.cnumber||""===this.cvc||""===this.date)return this.util.showToast(this.util.translate("All Fields are required"),"danger","bottom"),!1;if(!/^[\w._-]+[+]?[\w._-]+@[\w.-]+\.[a-zA-Z]{2,6}$/.test(this.email))return this.util.showToast(this.util.translate("Please enter valid email"),"danger","bottom"),!1;var e=this.date.split("-")[0],r=this.date.split("-")[1];if(this.util.userInfo&&this.util.userInfo.stripe_key&&""!==this.util.userInfo.stripe_key){var i={"card[number]":this.cnumber,"card[exp_month]":r,"card[exp_year]":e,"card[cvc]":this.cvc};this.util.show(),this.api.externalPost("https://api.stripe.com/v1/tokens",i,this.util.stripe).subscribe(function(e){e&&e.id?t.api.externalPost("https://api.stripe.com/v1/customers/"+t.util.userInfo.stripe_key+"/sources",{source:e.id},t.util.stripe).subscribe(function(e){t.util.hide(),t.back()},function(e){t.util.hide()}):t.util.hide()},function(e){if(t.util.hide(),e&&e.error&&e.error.error&&e.error.error.message)return t.util.errorToast(e.error.error.message),!1;t.util.errorToast("Algo ha ido mal")})}else{var n={"card[number]":this.cnumber,"card[exp_month]":r,"card[exp_year]":e,"card[cvc]":this.cvc};this.util.show(),this.api.externalPost("https://api.stripe.com/v1/tokens",n,this.util.stripe).subscribe(function(e){e&&e.id?t.api.externalPost("https://api.stripe.com/v1/customers",{description:"Customer for food app",source:e.id,email:t.email},t.util.stripe).subscribe(function(e){if(t.util.hide(),e&&e.id){var r={id:localStorage.getItem("uid"),stripe_key:e.id};t.updateUser(r)}},function(e){if(t.util.hide(),e&&e.error&&e.error.error&&e.error.error.message)return t.util.showErrorAlert(e.error.error.message),!1;t.util.errorToast("Algo ha ido mal")}):t.util.hide()},function(e){if(t.util.hide(),e&&e.error&&e.error.error&&e.error.error.message)return t.util.showErrorAlert(e.error.error.message),!1;t.util.errorToast("Algo ha ido mal")})}}},{key:"updateUser",value:function(t){var e=this;this.util.show(this.util.translate("updating...")),this.api.post("users/edit_profile",t).then(function(t){e.util.hide();var r={id:localStorage.getItem("uid")};e.api.post("users/getById",r).then(function(t){t&&200===t.status&&t.data&&t.data.length?(e.util.userInfo=t.data[0],e.navCtrl.back()):e.navCtrl.back()},function(t){})},function(t){e.util.hide(),e.util.errorToast("Algo ha ido mal")})}},{key:"getMaxDate",value:function(){return p().add("50","years").format("YYYY-MM-DD")}},{key:"minStartDate",value:function(){return p().format("YYYY-MM-DD")}}])&&e(i.prototype,n),a&&e(i,a),r}(),a.\u0275fac=function(t){return new(t||a)(m.Qb(u.db),m.Qb(h.a),m.Qb(b.a))},a.\u0275cmp=m.Kb({type:a,selectors:[["app-add-card"]],decls:20,vars:13,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"ion-padding"],[1,"inputType"],["type","email",3,"placeholder","ngModel","ngModelChange"],["type","number",3,"placeholder","ngModel","ngModelChange"],["type","text",3,"placeholder","ngModel","ngModelChange"],["type","password",3,"placeholder","ngModel","ngModelChange"],["display-format","MM/YYYY","placeholder","MM/YYYY",3,"min","max","ngModel","ngModelChange"],["expand","full","color","primary",1,"btn_addcard",3,"click"]],template:function(t,e){1&t&&(m.Vb(0,"ion-header"),m.Vb(1,"ion-toolbar",0),m.Vb(2,"ion-buttons",1),m.Vb(3,"ion-button",2),m.dc("click",function(){return e.back()}),m.Rb(4,"ion-icon",3),m.Ub(),m.Ub(),m.Vb(5,"ion-title"),m.Ac(6),m.Ub(),m.Ub(),m.Ub(),m.Vb(7,"ion-content",4),m.Vb(8,"div",5),m.Vb(9,"ion-input",6),m.dc("ngModelChange",function(t){return e.email=t}),m.Ub(),m.Ub(),m.Vb(10,"div",5),m.Vb(11,"ion-input",7),m.dc("ngModelChange",function(t){return e.cnumber=t}),m.Ub(),m.Ub(),m.Vb(12,"div",5),m.Vb(13,"ion-input",8),m.dc("ngModelChange",function(t){return e.cname=t}),m.Ub(),m.Ub(),m.Vb(14,"div",5),m.Vb(15,"ion-input",9),m.dc("ngModelChange",function(t){return e.cvc=t}),m.Ub(),m.Ub(),m.Vb(16,"div",5),m.Vb(17,"ion-datetime",10),m.dc("ngModelChange",function(t){return e.date=t}),m.Ub(),m.Ub(),m.Vb(18,"ion-button",11),m.dc("click",function(){return e.addcard()}),m.Ac(19),m.Ub(),m.Ub()),2&t&&(m.Fb(6),m.Cc(" ",e.util.translate("Add New Card")," "),m.Fb(3),m.nc("placeholder",e.util.translate("Email address"))("ngModel",e.email),m.Fb(2),m.nc("placeholder",e.util.translate("Card Number"))("ngModel",e.cnumber),m.Fb(2),m.nc("placeholder",e.util.translate("Card Holder Name"))("ngModel",e.cname),m.Fb(2),m.nc("placeholder",e.util.translate("CVC"))("ngModel",e.cvc),m.Fb(2),m.nc("min",e.minStartDate())("max",e.getMaxDate())("ngModel",e.date),m.Fb(2),m.Cc("",e.util.translate("Add Card")," "))},directives:[u.s,u.X,u.h,u.g,u.t,u.W,u.m,u.u,u.kb,c.h,c.k,u.fb,u.n,u.jb],styles:[".inputType[_ngcontent-%COMP%]{margin-bottom:10px;padding:0 5px;box-shadow:0 0 20px -3px rgba(30,98,255,.3)}ion-datetime[_ngcontent-%COMP%]{--padding-start:0px}"]}),a)}],g=((s=function e(){t(this,e)}).\u0275fac=function(t){return new(t||s)},s.\u0275mod=m.Ob({type:s}),s.\u0275inj=m.Nb({imports:[[d.i.forChild(f)],d.i]}),s),v=((o=function e(){t(this,e)}).\u0275fac=function(t){return new(t||o)},o.\u0275mod=m.Ob({type:o}),o.\u0275inj=m.Nb({imports:[[l.b,c.e,u.Y,g]]}),o)}}])}();