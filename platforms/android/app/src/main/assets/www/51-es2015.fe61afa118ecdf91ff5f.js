(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{akYc:function(t,e,n){"use strict";n.r(e),n.d(e,"TrackerPageModule",function(){return m});var i=n("ofXK"),o=n("3Pt+"),r=n("TEn/"),a=n("tyNb"),s=n("8RPc"),d=n("2Rin"),c=n("fXoL");const l=["map"];function g(t,e){if(1&t&&(c.Vb(0,"span",19),c.Ac(1),c.Ub()),2&t){const t=c.hc();c.Fb(1),c.Dc(" ",t.util.currecny," ",t.grandTotal,"")}}function p(t,e){if(1&t&&(c.Vb(0,"span",19),c.Ac(1),c.Ub()),2&t){const t=c.hc();c.Fb(1),c.Dc("",t.grandTotal," ",t.util.currecny,"")}}const h=function(t){return{"background-image":t}},_=[{path:"",component:(()=>{class t{constructor(t,e,n,i){this.route=t,this.api=e,this.util=n,this.navCtrl=i,this.id="",this.dName="",this.restAddress="",this.dCover="",this.phone="",this.status="",this.totalOrders=[]}ngOnInit(){this.route.queryParams.subscribe(t=>{t.hasOwnProperty("id")&&(this.id=t.id,this.getOrder())})}callDriver(){window.open("https://api.whatsapp.com/send?phone=91"+this.phone)}getOrder(){this.api.post("orders/getById",{id:this.id}).then(t=>{if(t&&200===t.status&&t.data.length){const e=t.data[0];if(this.totalOrders=JSON.parse(e.orders),this.grandTotal=e.grand_total,this.status=e.status,this.restAddress=e.str_address,this.payMethod="cod"===e.pay_method?"COD":"PAID",e&&e.address){const t=JSON.parse(e.address);this.myLat=t.lat,this.myLng=t.lng}e&&e.did&&"0"!==e.did&&(this.dId=e.did,this.getDriverInfo())}else this.util.back()},t=>{this.util.errorToast("Something went wrong")}).catch(t=>{this.util.errorToast("Something went wrong")})}getDriverInfo(){this.api.post("drivers/getById",{id:this.dId}).then(t=>{if(t&&200===t.status&&t.data.length){const e=t.data[0];this.dName=e.first_name+" "+e.last_name,this.dCover=e.cover,this.phone=e.mobile,this.driverLat=e.lat,this.driverLng=e.lng,this.loadMap(parseFloat(this.myLat),parseFloat(this.myLng),parseFloat(this.driverLat),parseFloat(this.driverLng))}},t=>{this.util.errorToast("Something went wrong")}).catch(t=>{this.util.errorToast("Something went wrong")})}changeMarkerPosition(t,e){this.api.post("drivers/getById",{id:this.dId}).then(n=>{if(n&&200===n.status&&n.data.length){const i=n.data[0];this.dName=i.first_name+" "+i.last_name,this.dCover=i.cover,this.phone=i.mobile,this.driverLat=i.lat,this.driverLng=i.lng;const o=new google.maps.LatLng(parseFloat(this.driverLat),parseFloat(this.driverLng));e.setCenter(o),t.setPosition(o)}},t=>{this.util.errorToast("Something went wrong")}).catch(t=>{this.util.errorToast("Something went wrong")})}loadMap(t,e,n,i){var o=new google.maps.DirectionsService,r=new google.maps.DirectionsRenderer;r=new google.maps.DirectionsRenderer;var a=new google.maps.LatLngBounds,s={lat:parseFloat(t),lng:parseFloat(e)},d={lat:n,lng:i},c=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:t,lng:e},disableDefaultUI:!0,zoom:100});const l=new google.maps.LatLng(t,e),g=(new google.maps.LatLng(n,i),{url:"assets/pin.png",scaledSize:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)});var p=new google.maps.Marker({map:c,position:l,animation:google.maps.Animation.DROP,icon:g});p.setMap(c),r.setOptions({polylineOptions:{strokeWeight:4,strokeOpacity:1,strokeColor:"red"},suppressMarkers:!0});var h=new google.maps.Geocoder;(new google.maps.DistanceMatrixService).getDistanceMatrix({origins:[s],destinations:[d],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},function(t,e){if("OK"!==e)alert("Error was: "+e);else{var n=t.originAddresses,i=t.destinationAddresses,l=(document.getElementById("output"),function(t){return function(t,e){"OK"===e?c.fitBounds(a.extend(t[0].geometry.location)):alert("Geocode was not successful due to: "+e)}});o.route({origin:s,destination:d,travelMode:"DRIVING"},function(t,e){"OK"===e?r.setDirections(t):window.alert("Directions request failed due to "+e)});for(let e=0;e<n.length;e++){let o=t.rows[e].elements;h.geocode({address:n[e]},l());for(let t=0;t<o.length;t++)h.geocode({address:i[t]},l())}}}),this.interval=setInterval(()=>{this.changeMarkerPosition(p,c)},1e3)}ionViewDidLeave(){clearInterval(this.interval)}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(a.a),c.Qb(s.a),c.Qb(d.a),c.Qb(r.db))},t.\u0275cmp=c.Kb({type:t,selectors:[["app-tracker"]],viewQuery:function(t,e){if(1&t&&c.Fc(l,3),2&t){let t;c.sc(t=c.ec())&&(e.mapElement=t.first)}},decls:32,vars:9,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"main_content_div"],[1,"upper_div"],["id","map",1,"map"],["map",""],[1,"lower_div"],[1,"head_lbl"],[1,"driver_detail_div"],[1,"back_image",3,"ngStyle"],[2,"padding-left","20px"],[1,"boy_name"],[1,"address"],["size","small","fill","outline",3,"click"],[1,"order_detail"],["style","color: var(--ion-color-primary);position: absolute;right: 20px;",4,"ngIf"],[1,"order_status"],[2,"color","var(--ion-color-primary)","position","absolute","right","20px"]],template:function(t,e){1&t&&(c.Vb(0,"ion-header"),c.Vb(1,"ion-toolbar",0),c.Vb(2,"ion-buttons",1),c.Vb(3,"ion-button",2),c.dc("click",function(){return e.util.back()}),c.Rb(4,"ion-icon",3),c.Ub(),c.Ub(),c.Vb(5,"ion-title"),c.Ac(6,"Rastrear"),c.Ub(),c.Ub(),c.Ub(),c.Vb(7,"ion-content"),c.Vb(8,"div",4),c.Vb(9,"div",5),c.Rb(10,"div",6,7),c.Ub(),c.Vb(12,"div",8),c.Vb(13,"ion-label",9),c.Ac(14,"Orden en camino"),c.Ub(),c.Vb(15,"div",10),c.Rb(16,"div",11),c.Vb(17,"div",12),c.Vb(18,"ion-label",13),c.Ac(19),c.Ub(),c.Vb(20,"ion-label",14),c.Ac(21),c.Ub(),c.Vb(22,"ion-button",15),c.dc("click",function(){return e.callDriver()}),c.Ac(23," Llamar "),c.Ub(),c.Ub(),c.Ub(),c.Vb(24,"ion-label",16),c.Ac(25),c.zc(26,g,2,2,"span",17),c.zc(27,p,2,2,"span",17),c.Ub(),c.Vb(28,"ion-label",16),c.Ac(29,"Estado"),c.Vb(30,"span",18),c.Ac(31),c.Ub(),c.Ub(),c.Ub(),c.Ub(),c.Ub()),2&t&&(c.Fb(16),c.nc("ngStyle",c.rc(7,h,"url("+e.api.mediaURL+e.dCover+"),url(assets/placeholder.jpg)")),c.Fb(3),c.Bc(e.dName),c.Fb(2),c.Bc(e.restAddress),c.Fb(4),c.Cc("",e.totalOrders.length," Productos "),c.Fb(1),c.nc("ngIf","left"===e.util.cside),c.Fb(1),c.nc("ngIf","right"===e.util.cside),c.Fb(4),c.Bc(e.status))},directives:[r.s,r.X,r.h,r.g,r.t,r.W,r.m,r.w,i.k,i.j],styles:[".main_content_div[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column;justify-content:space-between}.main_content_div[_ngcontent-%COMP%]   .upper_div[_ngcontent-%COMP%]{height:60vh}.main_content_div[_ngcontent-%COMP%]   .upper_div[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:100%;height:100%}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]{height:40vh;padding:20px}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{display:block}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .head_lbl[_ngcontent-%COMP%]{font-weight:600;font-size:20px;margin-top:10px}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .driver_detail_div[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-direction:row;align-items:center;position:relative}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .driver_detail_div[_ngcontent-%COMP%]   .back_image[_ngcontent-%COMP%]{height:50px!important;width:50px!important;border-radius:100%;background-position:50%;background-size:cover;background-repeat:no-repeat;min-width:50px}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .driver_detail_div[_ngcontent-%COMP%]   .boy_name[_ngcontent-%COMP%]{font-weight:600}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .driver_detail_div[_ngcontent-%COMP%]   .address[_ngcontent-%COMP%]{color:gray;width:80%}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .driver_detail_div[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:absolute;right:-3px;top:-5px;--border-radius:3px;font-weight:600}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .order_detail[_ngcontent-%COMP%]{font-weight:700;margin-top:20px}.main_content_div[_ngcontent-%COMP%]   .lower_div[_ngcontent-%COMP%]   .order_status[_ngcontent-%COMP%]{background:var(--ion-color-primary);position:absolute;right:20px;color:#fff;padding:3px 8px;border-radius:3px;text-transform:uppercase}"]}),t})()}];let b=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({imports:[[a.i.forChild(_)],a.i]}),t})(),m=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.Ob({type:t}),t.\u0275inj=c.Nb({imports:[[i.b,o.e,r.Y,b]]}),t})()}}]);