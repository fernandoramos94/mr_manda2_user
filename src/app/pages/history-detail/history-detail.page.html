<!-- 
  Authors : initappz (Rahul Jograna)
  Website : https://initappz.com/
  App Name : ionic 5 foodies app
  Created : 28-Feb-2021
  This App Template Source code is licensed as per the
  terms found in the Website https://initappz.com/license
  Copyright and Good Faith Purchasers © 2020-present initappz.
 -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="util.back()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Detalles de la órden #{{id}} </ion-title>
  
  </ion-toolbar>
</ion-header>

<ion-content>
  <div *ngIf="!loaded" style="display: flex;flex-direction: column;justify-content: center;align-items: center;">
    <ion-spinner color="primary" name="crescent"></ion-spinner>
  </div>
  <div class="main_content_div" *ngIf="loaded">
    <ion-label class="header_lbl">Resumen del pedido</ion-label>
    <ion-label class="res_location">Tu pedido en {{restName}} ha sido
      {{status}}
    </ion-label>

    <div class="line_div"></div>

    <ion-label class="res_location">{{address}}</ion-label>

    <div class="flex_div">
      <ion-label class="res_name" style="margin-top: 0px;">Tu órden</ion-label>
      <ion-label class="fav_lbl" (click)="trackMyOrder()" *ngIf="status =='ongoing' || status =='accepted' ">
        Rastrear pedido
      </ion-label>
    </div>

    <!-- <div class="line_div"></div> -->

    <span *ngFor="let item of orders">

      <div *ngFor="let subItems of item.selectedItem;let j = index" class="subNames">
        <ion-label class="food_title">
          {{item.name}} X
          {{item.selectedItem[j].total}}</ion-label>
        <div *ngFor="let addods of subItems.item" class="flex_titles">
          <p class="sub_name">
            - {{addods.name}}
          </p>
          <p class="sub_name" *ngIf="util.cside ==='left'">
            {{util.currecny}} {{addods.value}}
          </p>
          <p class="sub_name" *ngIf="util.cside ==='right'">
            {{addods.value}} {{util.currecny}}
          </p>
        </div>
      </div>

      <div class="card_div" *ngIf="!item.selectedItem || !item.selectedItem.length">
        <div class="flex_div">
          <ion-label class="food_title">{{item.name}} X {{item.quantiy}} </ion-label>
          <ion-label class="food_price" *ngIf="util.cside ==='left'">{{util.currecny}} {{item.quantiy * item.price}}
          </ion-label>
          <ion-label class="food_price" *ngIf="util.cside ==='right'"> {{item.quantiy * item.price}} {{util.currecny}}
          </ion-label>
        </div>

      </div>

    </span>

    <ion-label style="margin-top: 5px; font-weight: 600px;">Total productos
      <span class="prise_lbl" *ngIf="util.cside === 'left'">{{util.currecny}} {{total}}</span>
      <span class="prise_lbl" *ngIf="util.cside === 'right'">{{total}} {{util.currecny}}</span>
    </ion-label>
    <ion-label style="margin-top: 5px; font-weight: 600px;" *ngIf="coupon">Cupón
      <span class="prise_lbl" *ngIf="util.cside === 'left'">{{util.currecny}} {{dicount}}</span>
      <span class="prise_lbl" *ngIf="util.cside === 'right'">{{dicount}} {{util.currecny}}</span>
    </ion-label>
    <ion-label style="margin-top: 5px; font-size: 14px">Cargo por envío
      <span class="prise_lbl" *ngIf="util.cside === 'left'">{{util.currecny}} {{delivery_charge}}</span>
      <span class="prise_lbl" *ngIf="util.cside === 'right'">{{delivery_charge}} {{util.currecny}}</span>
    </ion-label>
    <ion-label style="margin-top: 5px; font-size: 14px">Cargo por servicio
      <span class="prise_lbl" *ngIf="util.cside === 'left'">{{util.currecny}} {{serviceTax}}</span>
      <span class="prise_lbl" *ngIf="util.cside === 'right'">{{serviceTax}} {{util.currecny}}</span>
    </ion-label>
    <ion-label style="margin-top: 5px; font-size: 14px">Total
      <span class="prise_lbl" *ngIf="util.cside === 'left'">{{util.currecny}} {{grandTotal}}</span>
      <span class="prise_lbl" *ngIf="util.cside === 'right'">{{grandTotal}} {{util.currecny}}</span>
    </ion-label>
    <div class="line_div"></div>

    <ion-label class="res_name">Detalles del pedido</ion-label>
    <div class="line_div"></div>

    <ion-label class="head_gray">Número del pedido</ion-label>
    <ion-label class="small_lbl">#{{id}}</ion-label>
    <ion-label class="head_gray">Notas</ion-label>
    <ion-label class="small_lbl">{{orderNotes}}</ion-label>
    <ion-label class="head_gray">Método de pago</ion-label>
    <ion-label class="small_lbl">{{util.translate('Paid :')}} {{paid}} </ion-label>
    <ion-label class="head_gray">Fecha</ion-label>
    <ion-label class="small_lbl">{{time}}</ion-label>
    <ion-label class="head_gray">Entregar en</ion-label>
    <ion-label class="small_lbl">{{deliveryAddress}}</ion-label>

    <div class="line_div"></div>

    <ion-label class="red_lbl" *ngIf="status =='creada' ||status =='ongoing' || status =='accepted' " (click)="call()">
      Llamar al comercio {{restName}}</ion-label>

    <ion-label class="red_lbl" *ngIf="status =='ongoing' || status =='accepted' " (click)="driverCall()">
     Llamar al repartidor {{driverName}}</ion-label>


  </div>
</ion-content>
<ion-footer>
  <ion-toolbar>
    <div class="btn_div">
      <ion-button *ngIf="status ==='delivered'" (click)="presentAlertConfirm()" size="small" class="ratae">
        <ion-icon name="star" color="light" slot="start"></ion-icon>
        Calificar pedido
      </ion-button>
      <ion-button *ngIf="status === 'created' ||status === 'ongoing' || status === 'accepted' " (click)="changeStatus()"
        size="small" class="reject">
        Cancelar pedido
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>